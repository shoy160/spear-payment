webpackJsonp([1],{"80lX":function(e,t){e.exports={name:"singerjs",version:"1.0.10",devDependencies:{autoprefixer:"^9.3.1","babel-core":"^6.26.3","babel-loader":"7.1.5","babel-preset-env":"^1.7.0","babel-preset-es2015":"^6.24.1",tap:"^12.0.1",webpack:"^4.23.1","webpack-cli":"^3.1.2","webpack-merge":"^4.1.4"},description:"Lightweight, applicable JavaScript auxiliary Library",main:"./lib/singer.js",dependencies:{},scripts:{test:"tap tests/*/*.js",compile:"babel -d lib/ src/",prepublish:"npm run compile",build:"webpack --config build/webpack.prod.js","build:dev":"webpack --config build/webpack.dev.js"},repository:{type:"git",url:"git+https://github.com/shoy160/Singer.git"},keywords:["singer"],author:"shoy160",license:"MIT",bugs:{url:"https://github.com/shoy160/Singer/issues"},homepage:"https://github.com/shoy160/Singer#readme",engines:{node:">= 6.0.0",npm:">= 3.0.0"},browserslist:["> 1%","last 2 versions","not ie <= 8"],files:["dist","lib"]}},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};i.d(a,"formatMoney",function(){return I});var n=i("fZjL"),s=i.n(n),r=i("7+uW"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]},l=i("VU/8")({name:"App"},o,!1,null,null,null).exports,c=i("/ocq"),d=i("W1rZ"),u=i.n(d),p=i("zowQ"),m=i.n(p),h=i("yS/O"),v=i("//Fk"),g=i.n(v);var f=i("mtWM"),b=i.n(f),y=i("Au9i"),A=i.n(y),w=b.a.create({baseURL:"",timeout:2e4});w.interceptors.request.use(function(e){return e},function(e){var t={status:-1,message:e.message};return g.a.reject(t)}),w.interceptors.response.use(function(e){var t=e.data;return t.hasOwnProperty("status")&&!t.status?(Object(y.Toast)(t.message),g.a.reject(t)):t.hasOwnProperty("totalCount")||!t.hasOwnProperty("data")?t:t.data},function(e){Object(y.Toast)(e.message);var t={status:-1,message:e.message};return g.a.reject(t)});var C=w,k={name:"index",data:function(){return{mode:1,type:1,alipay:!1,wechat:!1,detailId:"",trade:{amount:0},paying:!1,btnDisabled:!0,modes:[]}},created:function(){this.detailId=this.$route.params.id;var e=Object(h.UA)();e.mobile||this.$router.replace("/scan/"+this.detailId),this.alipay=e.alipay||!1,this.wechat=e.wechat||!1,this.alipay&&(this.type=2),this.wechat&&(this.type=3)},mounted:function(){var e,t=this;(this.wechat||this.modes.push({label:"支付宝",value:"0",icon:m.a}),this.alipay||this.modes.push({label:"微信",value:"1",icon:u.a}),0!==this.modes.length)&&(y.Indicator.open({text:"加载中...",spinnerType:"fading-circle"}),(e=this.detailId,C.get("trade/"+e)).then(function(e){if(1!==e.status){if(0!==e.status)return Object(y.Toast)("交易状态异常"),y.Indicator.close(),void(t.btnDisabled=!0);if(t.wechat&&!e.platformId)return i=t.detailId,a=1,void(location.href="/trade/platform/login?id="+i+"&mode="+a+"&redirect="+encodeURIComponent(location.href));var i,a;t.btnDisabled=!1,t.trade=e,t.modes.length>1?t.mode=e.mode:t.mode=t.modes[0].value,y.Indicator.close()}else location.href=e.redirectUrl}).catch(function(e){y.Indicator.close()}))},methods:{paymentHandler:function(){var e,t,i,a=this;this.btnDisabled=!0,y.Indicator.open({text:"支付中...",spinnerType:"fading-circle"}),(e=this.detailId,t=this.mode,i=this.type,C.post("trade/"+e,{mode:t,type:i})).then(function(e){var t;y.Indicator.close(),a.alipay?(a.paying=!0,(t=e,new g.a(function(e,i){var a;a=function(){console.log("start alipay"),window.AlipayJSBridge.call("tradePay",t,function(a){if(console.log(t),console.log(a),"9000"===a.resultCode)e();else{var n={message:"8000"===a.resultCode||"6004"===a.resultCode?"支付异常":"支付取消"};i(n)}})},window.AlipayJSBridge?a&&a():document.addEventListener("AlipayJSBridgeReady",a,!1)})).then(function(){a.trade.redirectUrl?location.href=a.trade.redirectUrl:a.paying=a.btnDisabled=!1})):a.wechat?(a.paying=!0,function(e){return new g.a(function(t,i){function a(){window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(a){if(console.log(e),console.log(a),"get_brand_wcpay_request:ok"===a.err_msg)t();else{var n={message:""};"get_brand_wcpay_request:cancel"===a.err_msg?n.message="支付取消":n.message=a.err_desc+a.err_code,i(n)}})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",a,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",a),document.attachEvent("onWeixinJSBridgeReady",a)):a()})}(e).then(function(){a.trade.redirectUrl?location.href=a.trade.redirectUrl:a.paying=a.btnDisabled=!1})):location.href=e}).catch(function(e){y.Indicator.close(),a.paying=a.btnDisabled=!1})},handleRepay:function(){location.reload(!0)},handleComplete:function(){this.trade.redirectUrl?location.href=this.trade.redirectUrl:this.paying=this.btnDisabled=!1}}},S={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("mt-header",{attrs:{title:"收银台"}}),e._v(" "),i("div",{staticClass:"p-amount"},[i("h3",[e._v(e._s(e.trade.title))]),e._v(" "),i("div",[i("small",[e._v("￥")]),e._v(" "),i("em",[e._v(e._s(e._f("formatMoney")(e.trade.amount)))])]),e._v(" "),e.trade.body?i("div",{staticClass:"p-body"},[e._v("\n      "+e._s(e.trade.body)+"\n    ")]):e._e()]),e._v(" "),i("div",{staticClass:"mint-radiolist"},[i("label",{staticClass:"mint-radiolist-title"},[e._v("选择支付方式")]),e._v(" "),e._l(e.modes,function(t){return i("a",{key:t.value,staticClass:"mint-cell"},[i("div",{staticClass:"mint-cell-left"}),e._v(" "),i("div",{staticClass:"mint-cell-wrapper"},[i("div",{staticClass:"mint-cell-title"},[i("label",{staticClass:"mint-radiolist-label"},[i("span",{staticClass:"mint-radio is-right"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.mode,expression:"mode"}],staticClass:"mint-radio-input",attrs:{type:"radio",name:"mode"},domProps:{value:t.value,checked:e._q(e.mode,t.value)},on:{change:function(i){e.mode=t.value}}}),e._v(" "),i("span",{staticClass:"mint-radio-core"})]),e._v(" "),i("span",{staticClass:"mint-radio-label"},[i("img",{attrs:{src:t.icon,alt:t.label}}),e._v(" "+e._s(t.label)+"\n            ")])])]),e._v(" "),e._m(0,!0)]),e._v(" "),i("div",{staticClass:"mint-cell-right"})])})],2),e._v(" "),i("div",{staticClass:"p-btn"},[i("mt-button",{attrs:{type:"primary",size:"large",disabled:e.btnDisabled},nativeOn:{click:function(t){return e.paymentHandler(t)}}},[e._v("确认支付")])],1),e._v(" "),i("mt-popup",{attrs:{closeOnClickModal:!1,"popup-transition":"popup-fade"},model:{value:e.paying,callback:function(t){e.paying=t},expression:"paying"}},[i("div",{staticClass:"paying-dialog"},[i("h5",[e._v("请确认支付是否完成")]),e._v(" "),i("mt-button",{attrs:{type:"primary",size:"large",plain:""},nativeOn:{click:function(t){return e.handleComplete(t)}}},[e._v("已完成支付")]),e._v(" "),i("mt-button",{attrs:{type:"default",size:"large",plain:""},nativeOn:{click:function(t){return e.handleRepay(t)}}},[e._v("支付遇到问题，重新支付")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mint-cell-value"},[t("span")])}]};var _=i("VU/8")(k,S,!1,function(e){i("medH")},"data-v-1fb52b58",null).exports,x={name:"Scan",data:function(){return{mode:-1,mobile:!1,alipay:!1,wechat:!1,detailId:"",code:"",logo:"/static/icb.png",payLogo:"/static/pay_logo.png",timg:"/static/timg.gif",redpack:"/static/alipay_redpack.png",redpackUrl:"hEYzc1x02556gmntkj9jkovdf382wD",size:300,margin:0,timer:null,time:8}},components:{VueQr:i("X2mQ").a},created:function(){this.detailId=this.$route.params.id,void 0!==this.$route.query.mode&&(this.mode=~~this.$route.query.mode);var e=Object(h.UA)();this.alipay=e.alipay,this.wechat=e.wechat,this.mobile=e.mobile,this.wechat?this.mode=1:this.alipay?this.mode=0:this.mobile&&this.$router.replace("/"+this.detailId)},mounted:function(){0!==this.mode&&1!==this.mode?this.loadModes():this.loadScan()},methods:{loadModes:function(){var e,t=this;y.Indicator.open({text:"加载中...",spinnerType:"fading-circle"}),(e=this.detailId,C.get("trade/modes/"+e)).then(function(e){if(1===e.length){var i=e[0];t.mode=i.mode,i.url?t.code=i.url:t.loadScan()}else t.code=location.href;y.Indicator.close()}).catch(function(e){y.Indicator.close()})},loadScan:function(){var e,t,i=this;y.Indicator.open({text:"加载中...",spinnerType:"fading-circle"}),(e=this.detailId,t=this.mode,C.get("trade/scan/"+e,{params:{mode:t}})).then(function(e){y.Indicator.close(),i.alipay?location.href=e:i.code=e}).catch(function(e){y.Indicator.close()})},handleRedpack:function(){this.timer&&this.timer.cancel(),location.href=this.redpackUrl}},destroyed:function(){this.timer&&this.timer.cancel()}},V={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"scan",class:e.mode>=0?"mode-"+e.mode:""},[-1===e.mode?i("div",{staticClass:"scan-container"},[i("h3",[e._v("扫码付款")]),e._v(" "),i("div",{staticClass:"qr"},[i("vue-qr",{attrs:{text:e.code,logoSrc:e.logo,size:e.size,margin:e.margin}})],1),e._v(" "),i("div",{staticClass:"logo"},[i("img",{attrs:{src:e.payLogo,alt:""}})])]):1===e.mode?i("div",{staticClass:"wechat"},[i("h3",[e._v("微信支付")]),e._v(" "),i("div",{staticClass:"qr-box"},[i("vue-qr",{staticClass:"qr",attrs:{text:e.code,logoSrc:e.logo,size:e.size,margin:e.margin}}),e._v(" "),i("img",{staticClass:"timg",attrs:{src:e.timg,alt:""}})],1),e._v(" "),i("h5",[e._v(e._s(e.mobile?"长按":"扫描")+"二维码识别")])]):0===e.mode?i("div",{staticClass:"alipay"},[e.alipay?[i("h4",[e._v("即将跳转到支付页面("+e._s(e.time)+"s)")])]:[i("h3",[e._v("支付宝支付")]),e._v(" "),i("div",{staticClass:"qr-box"},[i("vue-qr",{staticClass:"qr",attrs:{text:e.code,logoSrc:e.logo,size:e.size,margin:e.margin}}),e._v(" "),i("img",{staticClass:"timg",attrs:{src:e.timg,alt:""}})],1),e._v(" "),i("h5",[e._v(e._s(e.mobile?"长按":"扫描")+"二维码识别")])]],2):e._e()])},staticRenderFns:[]};var q=i("VU/8")(x,V,!1,function(e){i("z1Bp"),i("Qpl2")},"data-v-0d6e7a1f",null).exports;r.default.use(c.a);var B=new c.a({routes:[{path:"/:id",name:"Index",component:_},{path:"/scan/:id",name:"Scan",component:q}]}),I=(i("Qbok"),i("d8/S"),function(e){return(e/100).toFixed(2)});r.default.use(A.a),r.default.config.productionTip=!1,s()(a).forEach(function(e){r.default.filter(e,a[e])}),new r.default({el:"#app",router:B,components:{App:l},template:"<App/>"})},Qbok:function(e,t){},Qpl2:function(e,t){},W1rZ:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA6CAMAAADWZboaAAAAn1BMVEUAAAD///9QtDFIsjJFsjM0rzVbti91vChAsTM7sDRruSwsrjZ7vSZjti91xWMurCvv+Ova79OMy2z7/fqt3KNbvlljtSHV7MrF5K+V0YBruB/N6L+l15H0+vHf8de54KpNsSef0XSQylh8wkzq9uVSsis2rStptyVdsyRYsSBpvUc/rypFryT3/PXk8990v0VKtkJCsztXuENeuDw4rCHBcIhhAAAAAXRSTlMAQObYZgAAA1pJREFUSMeN1odiqjAABVCGaLUSBZmyxa3V2vb/v+0l4YYw+3pdFTm9SQBbhWW35JnVWciYNFMeTUTXiaMICFpjwehNUjhG9QmkCNhAKyw0oxOXUrhu66zXilK9ohOUgsL9Z66gBKWgSwa5Hpwr07qgn8pMyj+usF7RiUKragkN2WtlGK2gCOCW5rRYnDzP+731TVnOcAMsiziIfD/I4t3T88zusdElbbVul0WUqHXWgb04NyjCJKho3c6KB1AdqzDPcoE5bFJku/PVgUTlBXSgFbJI1MGs7crWpTXFSeAVG3Ukm5BZrbvAlGK0kIPWvnSuG1Aul3uxLsG+Jn6wxpivB0qhJV1wmuH3xyfvCbspzpcSNjqAyfEySnMqP6pdHqfTwgvQTw/pJcIASN6aqaTbGHskped5Pkb5vJzNFB8EOUq1Dj1ZKrIvdoGKpIVd/7z+xpAnbXp6JupokigO7TC8avk9b64v6PiRScMniQP/sd+nQUy0uy7pnFHPHoEf4TVMG+/9ULtBCrobqSzt7vVgkZsopdRceDg23d2uzsDW+EYlKMt+YJ/9M1CH4ty4pNRktdHALjY6+71HRtF6Lvo7ZGLtkno2a5yh5Egla2VZpL3FLS2cvtdrVEHyFW+qheYS9GxLBCG2kPudVMP4uf1Y2HYE5Tbr0FBscPK8mnT6dSMJJsOoATo1g87VbdXHKBVL7ouT7jHndMpjnqctm5C1Op71pzE3OEWcTePD5+Z3ajBqCnrJGh+W6z9QGb8xV2L9Qi2jTQ8lG2OUpQnOpfHEK0G1arwxheRw0K6EXdr2uPxwK6pplTxMLZ8ccvr2kOf3e66lo9RhklPkm2gU1rmP1j5ehqBTjT8qiP9TmB2ZbeKuagosofizlA1KAilbATjir9QO9D7Q+c6oXhfhSX7f3kjapQSS3hW+O4rqZxZu9dBv03BVQU71ViFngCzHiRtmvmVZkUPcOFF9A63vlEoIAoi8HY/Ht9frdVzRuNmHmCulOtJzkPj6M9jDWK2I+w4J2neAkDxUMAwJ2lVgHTg3mIZkdNIJ3KQHuanuoPqQm7dh3deUhkLaCn1tSDMHhKRxFQf7o6vtUInRohJRFMVtgh6UI8WLLIXtsaF1hYPkcUhPwTVZq9Kh7B9YL2IJJ8UTCQAAAABJRU5ErkJggg=="},"d8/S":function(e,t){},hxFq:function(e,t,i){"use strict";var a=i("qJhg"),n={render:function(){var e=this.$createElement,t=this._self._c||e;return this.bindElement?t("div",[t("img",this._b({},"img",{id:this.uuid},!1))]):this._e()},staticRenderFns:[]},s=i("VU/8")(a.a,n,!1,null,null,null);t.a=s.exports},medH:function(e,t){},z1Bp:function(e,t){},zowQ:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAA3lBMVEUAAACBxfBjt+1yv+603Pfq9P9etOxSset2wO5oue2w2/et2vcAieH///8AiOEAheBgtuxbs+xQruoOkOP7/v8JjuIFjOLy+f7a7vs1ouhGqurD5Pj1+/6p1/V5wfD4/P/s9v0mmuaRzPKExvExoOcZleXm9P2e0/Q8pekrneYTkuTj8vzf8Py33vdwve7I5vm/4fhpuu7v+P5Eqerd8Pua0PN8w/Bzvu5YsuzQ6fq73/ev2/ZluO1Bp+kun+ccluTW7PvM6Pmk1fSJyfJtvO5UsOsemOWr2PVdtewhmOVBNlwaAAAADHRSTlMAu/LHZBjy8sfHZGQVLkkbAAADBklEQVRIx7XW6XKqMBgGYHu6txKqgeCCsiMgi7jvWq1d7v+GThIKLsCc0pnz/lG+8QHyJWZSwnl+vK/+MPePzyWS2ysbsT8Osq9uMbqCoFwgAF6VSk9rbAqp9VPpGpULBl2X/rBFEfun9JKNAE02eslBRuj7frhCBRDgq6YgCKYKQQEE3ziGYcROQST9RwSOYfmQohHPgmMyEHCsRpxBVSVjkrzqIKlZDshAg3ntmC6Dw/VPKj0rC1kfzSSBS5EZHEuLehaCdj2OvlJpyxcrPamt4QVKtQKGcfeS5LYc8VGQMYmQwceVvHkCm0r7O5rHkTEFWlxY8SAH1T1R+I7EkUjkq4gjtGEeUsYfrcssTAanP80fEw9T0V8JCqx8BFIpv9Bp1owcBADpHkIRjfs56pOOTLMXLECOMniZTMLpYP1uQL4MqNGHxPRskInQWuuZMo5pDnsjv7GB+JEs3xYwkjSYiRTV5ZgknCh05+PqxqnTNryuQOr1qBHwDQUSUYq0JHd7nUWffN1vMhBQOhw33IWW/fVuW5/4PcUIcvRjiNd3GrG+zCzIKGgHoaM0RrVIURkMIOnoOQKKx7UUAkhovx1l6QmxE7tzX4f8BarWgsbl/gqVt2byNMmcdZY2T+oJ8kUVFy6Z7sUm6kvNm9QdlCBNaqe3Kkc1mfNIboCfh2LEjFPoS6PT2pzs+qcTKG89taISNOZGxoUyVLq1zA6OXenIzGnkrUvQYeiGZwRZLZE8Z9bg8dCNgbYVz1zUciZoIJC0wFg26Y9eKwhEhcE4OGV0GYVDbqbV+e+V63v0PyR8WNRQBvVKq8udIvC+7zNybzRZTisTde5Gr76vA2JihuzpaHuCsBqT/va7Q1eObifspk5ikte22nM5Rrhg+D2JSdJf+HY5PXWAhfVw51JEr3l9qc5nbrdb63XGBwWlSLwlfFX3M4ziy41VnX5WDiuFZyOS4xztdN+L869zxOfvDh8PxY85D6UbveiBSr/5zdGNHhL1IodEHR8SSW6u7yo/zN31DQZ/AWiLwkLW8ewJAAAAAElFTkSuQmCC"}},["NHnr"]);
//# sourceMappingURL=app.0cf979d0decaacd8ef8b.js.map
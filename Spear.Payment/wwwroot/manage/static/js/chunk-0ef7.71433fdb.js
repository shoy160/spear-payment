(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0ef7"],{"/8pQ":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-main",{staticClass:"app-container"},[a("div",{staticClass:"app-container"},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"交易号/订单号"},model:{value:t.listQuery.tradeNo,callback:function(e){t.$set(t.listQuery,"tradeNo",e)},expression:"listQuery.tradeNo"}}),t._v(" "),a("el-select",{attrs:{clearable:"",placeholder:"支付方式"},model:{value:t.listQuery.mode,callback:function(e){t.$set(t.listQuery,"mode",e)},expression:"listQuery.mode"}},t._l(t.modes,function(t){return a("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),t._v(" "),a("el-select",{attrs:{clearable:"",placeholder:"支付类型"},model:{value:t.listQuery.type,callback:function(e){t.$set(t.listQuery,"type",e)},expression:"listQuery.type"}},t._l(t.types,function(t){return a("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),t._v(" "),a("el-select",{attrs:{clearable:"",placeholder:"支付状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},t._l(t.statusList,function(t){return a("el-option",{key:t.key,attrs:{value:t.key,label:t.text}})})),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("\n      "+t._s(t.$t("table.search"))+"\n    ")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"table-expand",attrs:{inline:""}},[a("el-form-item",{attrs:{label:"商户订单号"}},[a("span",[t._v(t._s(e.row.orderNo))])]),t._v(" "),a("el-form-item",{attrs:{label:"第三方交易号"}},[a("span",[t._v(t._s(e.row.outTradeNo))])]),t._v(" "),a("el-form-item",{attrs:{label:"跳转地址"}},[a("span",[t._v(t._s(e.row.redirectUrl))])]),t._v(" "),a("el-form-item",{attrs:{label:"支付描述"}},[a("span",[t._v(t._s(e.row.body))])]),t._v(" "),a("el-form-item",{attrs:{label:"扩展信息"}},[a("span",[t._v(t._s(e.row.extend))])])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{type:"index"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tradeNo",label:"交易号",width:"180px"}}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"100px"}}),t._v(" "),a("el-table-column",{attrs:{prop:"projectName",label:"项目"}}),t._v(" "),a("el-table-column",{attrs:{label:"金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b",{staticStyle:{color:"#f56c6c"}},[t._v("￥ "+t._s(t._f("amountFormatter")(e.row.amount)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.paymode"),filters:t.modes,"filter-method":t.handleFilter,prop:"mode"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:["","info"][e.row.mode]}},[t._v(t._s(e.row.modeCn))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.paytype"),prop:"type"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:"warning"}},[t._v(t._s(e.row.type))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.status")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:["danger","success"][e.row.status]}},[t._v(t._s(e.row.statusCn))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.date"),prop:"createTime",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("parseTime")(e.row.createTime,"{y}-{m}-{d} {h}:{i}:{s}"))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.paidTime"),prop:"paidTime",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("parseTime")(e.row.paidTime,"{y}-{m}-{d} {h}:{i}:{s}"))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.actions")},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.status||3===e.row.status?a("el-button",{attrs:{disabled:!e.row.notify||e.row.notifying||e.row.notifyTime>0,title:e.row.notifyTime>0?e.row.notifyTime+"秒":"异步通知",size:"mini",icon:"el-icon-bell",circle:""},on:{click:function(a){t.handleNotify(e.$index,e.row)}}}):t._e(),t._v(" "),1===e.row.status?a("el-button",{attrs:{type:"danger",title:"退款",size:"mini",icon:"el-icon-remove",circle:""},on:{click:function(a){t.handleRefund(e.row.tradeNo)}}}):t._e(),t._v(" "),0===e.row.status?a("a",{staticClass:"el-button el-button--primary el-button--mini is-circle",attrs:{href:"/#/scan/"+e.row.id,target:"_blank",title:"收银台"}},[a("i",{staticClass:"fa fa-money"})]):t._e(),t._v(" "),0===e.row.status?a("el-button",{attrs:{title:"支付校验",size:"mini",icon:"el-icon-refresh",circle:""},on:{click:function(a){t.handleVerifyTrade(e.row.tradeNo)}}}):t._e()]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{total:t.listTotal,"page-sizes":[10,20,30,50],background:"",layout:"total, sizes, prev, pager, next"},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)},i=[];a.d(e,"a",function(){return n}),a.d(e,"b",function(){return i})},"87eB":function(t,e,a){"use strict";var n=a("p+al");a.n(n).a},JGVM:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.notifyList=e.refund=e.verifyTrade=e.tradeNotify=e.tradeList=void 0;var n=function(t){return t&&t.__esModule?t:{default:t}}(a("t3Un"));e.tradeList=function(t){return n.default.post("/manage/trade/list",t)},e.tradeNotify=function(t){return n.default.put("/manage/trade/notify/"+t)},e.verifyTrade=function(t){return n.default.get("/manage/trade/verify/"+t)},e.refund=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n.default.put("/manage/trade/refund/"+t,{params:{amount:e,reason:a}})},e.notifyList=function(t){return n.default.get("/manage/trade/notifys",{params:t})}},bdZc:function(t,e,a){"use strict";a.r(e);var n=a("mxeV"),i=a.n(n);for(var l in n)"default"!==l&&function(t){a.d(e,t,function(){return n[t]})}(l);e.default=i.a},hQ1w:function(t,e,a){"use strict";a.r(e);var n=a("/8pQ"),i=a("bdZc");for(var l in i)"default"!==l&&function(t){a.d(e,t,function(){return i[t]})}(l);a("87eB");var r=a("KHd+"),s=Object(r.a)(i.default,n.a,n.b,!1,null,null,null);s.options.__file="index.vue",e.default=s.exports},mxeV:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("JGVM");e.default={name:"Trade",data:function(){return{modes:[{text:"支付宝",value:0},{text:"微信",value:1}],types:[{value:0,text:"Web"},{value:1,text:"H5"},{value:2,text:"App"},{value:3,text:"Public"},{value:4,text:"Scan"},{value:5,text:"Barcode"},{value:6,text:"Applet"}],statusList:[{key:0,text:"待支付"},{key:1,text:"已支付"},{key:2,text:"已关闭"},{key:3,text:"已退款"},{key:4,text:"退款中"}],list:[],listLoading:!0,listTotal:0,notifyInterval:60,listQuery:{page:1,size:10,mode:null,type:void 0,tradeNo:""},timer:null}},mounted:function(){this.getList()},methods:{startTimer:function(){var t=this;this.timer||(this.timer=setInterval(function(){var e=!1;t.list.forEach(function(a,n){!a.notifyTime||a.notifyTime<=0||(a.notifyTime--,t.$set(t.list,n,a),!e&&a.notifyTime>0&&(e=!0))}),e||(clearInterval(t.timer),t.timer=null)},1e3))},getList:function(){var t=this;this.listLoading=!0,(0,n.tradeList)(this.listQuery).then(function(e){t.list=e.data,t.listTotal=e.total,t.listLoading=!1})},handleSearch:function(){this.listQuery.page=1,this.getList()},handleNotify:function(t,e){var a=this;e.notifying=!0,this.$set(this.list,t,e),(0,n.tradeNotify)(e.id).then(function(){a.$message.success("通知成功"),e.notifying=!1,e.notifyTime=a.notifyInterval,a.startTimer()}).catch(function(){e.notifying=!1,a.$set(a.list,t,e)})},handleFilter:function(t,e,a){return e[a.property]===t},handleSizeChange:function(t){this.listQuery.size=t,this.listQuery.page=1,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handleVerifyTrade:function(t){var e=this;(0,n.verifyTrade)(t).then(function(){e.$message.success("校验成功"),e.getList()})},handleRefund:function(t){var e=this;this.$prompt("请输入退款原因","交易退款",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.+$/,inputErrorMessage:"请输入退款原因"}).then(function(a){var i=a.value;(0,n.refund)(t,-1,i||"").then(function(){e.$message.success("退款成功"),e.getList()})})}},distroyed:function(){this.timer&&clearInterval(this.timer)}}},"p+al":function(t,e,a){}}]);